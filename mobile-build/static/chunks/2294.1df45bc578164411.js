"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2294],{32294:(e,t,i)=>{i.r(t),i.d(t,{capacitorService:()=>w,default:()=>v});var o=i(32587),a=i(39226),r=i(92365),n=i(93589),c=i(81494),s=i(8703),l=i(8781),d=i(71223),u=i(30249),h=i(64375),f=i(4077),g=i(24995);class p{async initialize(){if(!this.isInitialized)try{o.Ii.isNativePlatform()&&await this.initializeNativeFeatures(),this.deviceInfo=await this.getDeviceInfo(),await this.initializeNetworkMonitoring(),await this.initializePushNotifications(),this.isInitialized=!0,console.log("CapacitorService: Initialized successfully")}catch(e){console.error("CapacitorService: Initialization failed",e)}}async initializeNativeFeatures(){try{await r.eA.setStyle({style:r.OF.Dark}),await r.eA.setBackgroundColor({color:"#1A237E"}),await n.SplashScreen.hide(),a.q.addListener("appStateChange",e=>{let{isActive:t}=e;console.log("App state changed. Is active?",t)}),a.q.addListener("appUrlOpen",e=>{console.log("App opened with URL:",e.url)}),a.q.addListener("appRestoredResult",e=>{console.log("App restored with result:",e)}),console.log("Native features initialized")}catch(e){console.error("Failed to initialize native features:",e)}}async getDeviceInfo(){try{let e=await h.p.getInfo(),t=await u.l.getStatus();return{isNative:o.Ii.isNativePlatform(),platform:e.platform,model:e.model,osVersion:e.osVersion,appVersion:"1.0.0",isConnected:t.connected,connectionType:t.connectionType}}catch(e){return console.error("Failed to get device info:",e),{isNative:!1,platform:"web",model:"unknown",osVersion:"unknown",appVersion:"1.0.0",isConnected:navigator.onLine,connectionType:"unknown"}}}async initializeNetworkMonitoring(){try{u.l.addListener("networkStatusChange",e=>{console.log("Network status changed:",e),window.dispatchEvent(new CustomEvent("networkStatusChange",{detail:e}))})}catch(e){console.error("Failed to initialize network monitoring:",e)}}async initializePushNotifications(){if(o.Ii.isNativePlatform())try{let e=await c.h.requestPermissions();"granted"===e.receive&&await c.h.register(),c.h.addListener("registration",e=>{console.log("Push registration success, token: "+e.value),this.storePushToken(e.value)}),c.h.addListener("registrationError",e=>{console.error("Error on registration: "+JSON.stringify(e))}),c.h.addListener("pushNotificationReceived",e=>{console.log("Push notification received: ",e),this.handleNotificationReceived(e)}),c.h.addListener("pushNotificationActionPerformed",e=>{console.log("Push notification action performed",e.actionId,e.inputValue),this.handleNotificationAction(e)})}catch(e){console.error("Failed to initialize push notifications:",e)}}async storePushToken(e){try{await f.p.set({key:"push_token",value:e}),console.log("Push token stored:",e)}catch(e){console.error("Failed to store push token:",e)}}handleNotificationReceived(e){this.triggerHapticFeedback(),this.showLocalNotification({title:e.title||"PathNiti",body:e.body||"You have a new notification",data:e.data})}handleNotificationAction(e){let t=e.actionId,i=e.notification.data;switch(t){case"tap":(null==i?void 0:i.url)&&(window.location.href=i.url);break;case"view":(null==i?void 0:i.page)&&(window.location.href=i.page);break;default:console.log("Unknown notification action:",t)}}async showLocalNotification(e){if(o.Ii.isNativePlatform())try{await s.W.schedule({notifications:[{title:e.title,body:e.body,id:Date.now(),schedule:{at:new Date(Date.now()+1e3)},sound:"beep.wav",attachments:void 0,actionTypeId:"",extra:e.data}]})}catch(e){console.error("Failed to show local notification:",e)}}async getCurrentLocation(){if(!o.Ii.isNativePlatform())return new Promise(e=>{if(!navigator.geolocation)return void e(null);navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,timestamp:t.timestamp})},t=>{console.error("Geolocation error:",t),e(null)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:3e5})});try{let e=await l.L.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4});return{latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy,timestamp:e.timestamp}}catch(e){return console.error("Failed to get location:",e),null}}async takePhoto(){if(!o.Ii.isNativePlatform())return new Promise(e=>{let t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=t=>{var i;let o=null==(i=t.target.files)?void 0:i[0];if(o){let t=new FileReader;t.onload=()=>e(t.result),t.readAsDataURL(o)}else e(null)},t.click()});try{return(await d.i7.getPhoto({quality:90,allowEditing:!1,resultType:d.LK.DataUrl,source:d.ru.Camera})).dataUrl||null}catch(e){return console.error("Failed to take photo:",e),null}}async triggerHapticFeedback(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.kn.Medium;if(o.Ii.isNativePlatform())try{await g.dn.impact({style:e})}catch(e){console.error("Failed to trigger haptic feedback:",e)}}async isOnline(){if(!o.Ii.isNativePlatform())return navigator.onLine;try{return(await u.l.getStatus()).connected}catch(e){return console.error("Failed to check network status:",e),navigator.onLine}}async setPreference(e,t){try{await f.p.set({key:e,value:t})}catch(e){console.error("Failed to set preference:",e)}}async getPreference(e){try{return(await f.p.get({key:e})).value}catch(e){return console.error("Failed to get preference:",e),null}}async removePreference(e){try{await f.p.remove({key:e})}catch(e){console.error("Failed to remove preference:",e)}}getDeviceInfoSync(){return this.deviceInfo}isNative(){return o.Ii.isNativePlatform()}getPlatform(){return o.Ii.getPlatform()}constructor(){this.isInitialized=!1,this.deviceInfo=null}}let w=new p,v=w}}]);