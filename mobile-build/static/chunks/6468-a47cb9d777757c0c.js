"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6468],{46468:(e,s,a)=>{a.d(s,{SarthiChat:()=>y});var t=a(95155),i=a(12115),l=a(47061),r=a(3998),n=a(65142),c=a(86948),o=a(37586),d=a(78192),x=a(3166),m=a(33738),h=a(48314),u=a(20508),f=a(35299),p=a(18085),g=a(74636);function y(e){let{className:s="",initialMessage:a}=e,{user:y,profile:w}=(0,l.A)(),[v,j]=(0,i.useState)([]),[N,b]=(0,i.useState)(""),[_,S]=(0,i.useState)(!1),[k,E]=(0,i.useState)(null),[C,A]=(0,i.useState)(!1),[D,O]=(0,i.useState)(navigator.onLine),I=(0,i.useRef)(null),z=(0,i.useRef)(null),L=(0,i.useCallback)(()=>{var e;null==(e=I.current)||e.scrollIntoView({behavior:"smooth"})},[]);(0,i.useEffect)(()=>{L()},[v,L]);let P=(0,i.useCallback)(async()=>{try{let e=await fetch("/api/chat/session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:null==y?void 0:y.id,session_name:"Chat with Sarthi"})});if(e.ok){let s=await e.json();E(s.session_id)}else console.error("Failed to initialize chat session")}catch(e){console.error("Error initializing chat session:",e)}},[null==y?void 0:y.id]);(0,i.useEffect)(()=>{y&&!k&&P()},[y,k,P]),(0,i.useEffect)(()=>{let e=()=>O(!0),s=()=>O(!1);return window.addEventListener("online",e),window.addEventListener("offline",s),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",s)}},[]);let M=(0,i.useCallback)(async e=>{let s=e||N.trim();if(!s||!k)return;let a={id:Date.now().toString(),session_id:k||"",type:"user",content:s,timestamp:new Date().toISOString()};j(e=>[...e,a]),b(""),S(!0),A(!0);try{let e=await g.v.processMessage(s,k,{user_profile:w?{user_id:(null==y?void 0:y.id)||"",class_level:w.class_level||"",stream:w.stream||"",interests:w.interests||[],location:w.location||{}}:void 0,conversation_history:v}),t={id:(Date.now()+1).toString(),session_id:k,type:"assistant",content:e.response,timestamp:new Date().toISOString(),metadata:{capability_used:e.capability_used,confidence_score:e.confidence_score,processing_time_ms:e.processing_time_ms,is_offline_response:e.is_offline_response}};j(e=>[...e,t]),await g.v.saveMessage(a),await g.v.saveMessage(t)}catch(s){console.error("Error sending message:",s);let e={id:(Date.now()+1).toString(),session_id:k,type:"assistant",content:"I apologize, but I encountered an error processing your request. Please try again or rephrase your question.",timestamp:new Date().toISOString(),metadata:{capability_used:"error_handling",confidence_score:.1,processing_time_ms:0,is_offline_response:!0}};j(s=>[...s,e])}finally{S(!1),A(!1)}},[N,k,y,w,v]);(0,i.useEffect)(()=>{a&&k&&0===v.length&&M(a)},[a,k,v.length,M]);let T=async()=>{if(k)try{await fetch("/api/chat/session/reset",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:k})}),j([]),await P()}catch(e){console.error("Failed to reset conversation:",e)}};return y?(0,t.jsxs)("div",{className:"w-full h-full bg-white flex flex-col ".concat(s),children:[(0,t.jsx)("div",{className:"border-b border-gray-200 px-6 py-4 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,t.jsx)(d.A,{className:"w-5 h-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900 text-lg",children:"Sarthi"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Education Counselor"}),D?(0,t.jsxs)("div",{className:"flex items-center space-x-1 text-green-600",children:[(0,t.jsx)(x.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"text-xs",children:"Online"})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-1 text-orange-600",children:[(0,t.jsx)(m.A,{className:"h-3 w-3"}),(0,t.jsx)("span",{className:"text-xs",children:"Offline"})]})]})]})]}),(0,t.jsx)(r.$,{variant:"ghost",size:"sm",onClick:T,disabled:_,className:"text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-full",children:(0,t.jsx)(h.A,{className:"w-4 h-4"})})]})}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto px-6 py-6",children:[(0,t.jsxs)("div",{className:"space-y-6 max-w-4xl mx-auto",children:[v.map(e=>(0,t.jsx)("div",{className:"flex ".concat("user"===e.type?"justify-end":"justify-start"),children:(0,t.jsxs)("div",{className:"flex gap-4 max-w-[85%] ".concat("user"===e.type?"flex-row-reverse":"flex-row"),children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0 ".concat("user"===e.type?"bg-blue-500":"bg-gradient-to-r from-blue-500 to-purple-600"),children:"user"===e.type?(0,t.jsx)(u.A,{className:"w-5 h-5 text-white"}):(0,t.jsx)(d.A,{className:"w-5 h-5 text-white"})}),(0,t.jsx)("div",{className:"rounded-2xl px-5 py-3 shadow-sm ".concat("user"===e.type?"bg-blue-500 text-white":"bg-gray-100 text-gray-900"),children:(0,t.jsx)("div",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:e.content})})]})},e.id)),C&&(0,t.jsx)("div",{className:"flex justify-start",children:(0,t.jsxs)("div",{className:"flex gap-4 max-w-[85%]",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0",children:(0,t.jsx)(d.A,{className:"w-5 h-5 text-white"})}),(0,t.jsx)("div",{className:"bg-gray-100 rounded-2xl px-5 py-3 shadow-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Sarthi is typing"}),(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})]})})]})})]}),(0,t.jsx)("div",{ref:I})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 p-6 flex-shrink-0",children:(0,t.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(n.p,{ref:z,value:N,onChange:e=>b(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},placeholder:"Message Sarthi...",disabled:_,className:"flex-1 border-gray-300 rounded-full px-6 py-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent shadow-sm"}),(0,t.jsx)(r.$,{onClick:()=>M(),disabled:_||!N.trim(),size:"sm",className:"rounded-full w-12 h-12 p-0 bg-blue-500 hover:bg-blue-600 shadow-sm",children:_?(0,t.jsx)(f.A,{className:"w-5 h-5 animate-spin"}):(0,t.jsx)(p.A,{className:"w-5 h-5"})})]})})})]}):(0,t.jsx)(c.Zp,{className:"w-full max-w-4xl mx-auto ".concat(s),children:(0,t.jsxs)(c.Wu,{className:"p-8 text-center",children:[(0,t.jsx)(o.A,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sign in to chat with Sarthi"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please sign in to start your conversation with AI Sarthi."})]})})}}}]);